<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>授業用タイマー（Pro）</title>
    <style>
        body { margin: 0; background: #222; color: #fff; font-family: 'Helvetica Neue', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #timer { font-size: 25vw; font-weight: bold; font-variant-numeric: tabular-nums; line-height: 1; margin-bottom: 20px; transition: color 0.3s; }
        .controls { display: flex; flex-direction: column; align-items: center; gap: 20px; width: 90%; }
        .row { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        
        button { font-size: 1.5rem; padding: 12px 24px; cursor: pointer; border: none; border-radius: 12px; background: #444; color: white; transition: background 0.2s, transform 0.1s; }
        button:hover { background: #666; }
        button:active { transform: scale(0.95); }
        
        .quick-btn { background: #007bff; font-weight: bold; } /* 1,3,5分ボタン */
        .adjust-btn { background: #555; font-size: 1.2rem; }   /* +-ボタン */
        .main-btn { background: #28a745; font-size: 2rem; padding: 15px 40px; } /* スタート */
        .reset-btn { background: #dc3545; }
        
        .warning { color: #ffeb3b; }
        .danger { color: #f44336; }
    </style>
</head>
<body>
    <div id="timer">05:00</div>

    <div class="controls">
        <div class="row">
            <button class="adjust-btn" onclick="addTime(60)">分 +</button>
            <button class="adjust-btn" onclick="addTime(-60)">分 -</button>
            <button class="adjust-btn" onclick="addTime(1)">秒 +</button>
            <button class="adjust-btn" onclick="addTime(-1)">秒 -</button>
        </div>

        <div class="row">
            <button class="quick-btn" onclick="setQuickTime(1)">1分</button>
            <button class="quick-btn" onclick="setQuickTime(3)">3分</button>
            <button class="quick-btn" onclick="setQuickTime(5)">5分</button>
        </div>

        <div class="row">
            <button class="main-btn" onclick="toggleTimer()" id="startBtn">スタート</button>
            <button class="reset-btn" onclick="resetTimer()">リセット</button>
        </div>
    </div>

    <script>
        let initialTime = 300;
        let timeLeft = 300;
        let timerId = null;
        
        // ブラウザ標準のアラーム音（ビープ音）の設定
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playAlarm() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); // A5の音
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 1); // 1秒間鳴らす
        }

        function updateDisplay() {
            const min = Math.floor(Math.abs(timeLeft) / 60);
            const sec = Math.abs(timeLeft) % 60;
            const display = `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            const timerEl = document.getElementById('timer');
            timerEl.textContent = display;
            
            timerEl.className = '';
            if (timeLeft <= 0) timerEl.classList.add('danger');
            else if (timeLeft <= 60) timerEl.classList.add('warning');
        }

        function setQuickTime(minutes) {
            initialTime = minutes * 60;
            timeLeft = initialTime;
            updateDisplay();
            if (timerId) stopTimer();
        }

        function addTime(seconds) {
            if (timeLeft + seconds < 0) timeLeft = 0;
            else timeLeft += seconds;
            updateDisplay();
        }

        function toggleTimer() {
            if (timerId) stopTimer();
            else startTimer();
        }

        function startTimer() {
            // ブラウザの音再生制限を解除するためにクリック時にAudioContextを再開
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            timerId = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateDisplay();
                } else {
                    stopTimer();
                    playAlarm();
                    setTimeout(() => alert("Time's up!"), 100);
                }
            }, 1000);
            document.getElementById('startBtn').textContent = '一時停止';
            document.getElementById('startBtn').style.background = '#ffc107';
        }

        function stopTimer() {
            clearInterval(timerId);
            timerId = null;
            document.getElementById('startBtn').textContent = 'スタート';
            document.getElementById('startBtn').style.background = '#28a745';
        }

        function resetTimer() {
            stopTimer();
            timeLeft = initialTime;
            updateDisplay();
        }
    </script>
</body>
</html>
